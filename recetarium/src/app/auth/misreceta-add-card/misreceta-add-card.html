<div class="receta-card">

  <!-- INTRO -->
  <div class="introduccion" (click)="toggleDetalles()" role="button" aria-pressed="{{abierta}}">
    <div class="imagen-container" *ngIf="receta.imagen">
      <img [src]="receta.imagen" alt="{{ receta.titulo }}" class="imagen-banner" />
    </div>

    <div class="texto">
      <div class="titulo-row">
        <h2 class="titulo">{{ receta.titulo }}</h2>
        <span [ngClass]="dietaBadgeClass()" class="dieta-badge">{{ dietaLabel() }}</span>
      </div>
      <p class="categoria" *ngIf="receta.categoria_nombre">{{ receta.categoria_nombre }}</p>
      <p class="descripcion">{{ receta.descripcion }}</p>
    </div>

    <div class="toggle-area">
      <span class="flecha" [class.rotar]="abierta">â–¼</span>
    </div>
  </div>

  <!-- DETALLES -->
  <div class="detalles" [class.abierto]="abierta" [style.maxHeight]="abierta ? '2000px' : '0'">
    <div *ngIf="cargando" class="loading">Cargando detalles...</div>

    <div *ngIf="abierta && detalles">
      <p><strong>â± Tiempo:</strong> {{ receta.tiempo_preparacion }} min</p>
      <p><strong>ğŸ½ Porciones:</strong> {{ receta.porciones }}</p>
      <p><strong>ğŸ”¥ Dificultad:</strong> {{ receta.dificultad }}</p>

      <hr>

      <div *ngIf="detalles.ingredientes?.length; else noIngredientes">
        <h4>ğŸ§‚ Ingredientes:</h4>
        <ul>
          <li *ngFor="let ing of detalles.ingredientes">
            {{ ing.nombre }} â€” {{ ing.cantidad }} {{ ing.unidad }}
            <span *ngIf="ing.nota">({{ ing.nota }})</span>
          </li>
        </ul>
      </div>
      <ng-template #noIngredientes>
        <p class="muted">No hay ingredientes registrados.</p>
      </ng-template>

      <div *ngIf="detalles.pasos?.length; else noPasos">
        <h4>ğŸ‘¨â€ğŸ³ Pasos:</h4>
        <ol>
          <li *ngFor="let paso of detalles.pasos">{{ paso.numero_paso }}. {{ paso.descripcion }}</li>
        </ol>
      </div>
      <ng-template #noPasos>
        <p class="muted">No hay pasos registrados.</p>
      </ng-template>

      <div class="acciones-detalles">
        <button class="agregar" (click)="agregarAlCalendario()">â• Agregar al calendario</button>
      </div>
    </div>
  </div>

</div>
